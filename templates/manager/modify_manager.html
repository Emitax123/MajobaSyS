{% extends 'base.html' %}
{% load static %}
{% block content %}
  <link rel="stylesheet" href="{% static 'css/modify_manager.css' %}" />
  <div class="admin-manager-container">

    <!-- Panel: datos del usuario -->
    <section class="manager-data" aria-label="Datos del usuario">
      <span class="data-title">Datos del usuario</span>
      <span class="data-item">
        Nombre
        <span class="data-value">{{ user.get_full_name }}</span>
      </span>
      <span class="data-item">
        Puntos actuales
        <span class="data-value">{{ manager_info.points }}</span>
      </span>
      <span class="data-item">
        Nivel actual
        <span class="data-value">{{ manager_info.acc_level }}</span>
      </span>
    </section>

    <!-- Panel: acciones y formularios -->
    <div class="manager-mod-container">

      <!-- Acciones -->
      <div class="manager-modify" aria-label="Modificación de datos">
        <span class="data-title">Modificación de datos</span>
        <a href="{% url 'user_modify' user.id %}">Cambiar datos de usuario</a>
        <button id="add-btn" type="button" class="red-btn add-btn" aria-expanded="false" aria-controls="add-form">
          Sumar puntos
        </button>
        <button id="minus-btn" type="button" class="red-btn minus-btn" aria-expanded="false" aria-controls="minus-form">
          Restar puntos
        </button>
      </div>

      <!-- Formularios (se muestran con JS) -->
      <div id="manager-forms" class="manager-forms" style="display:none;" aria-live="polite">

        <form id="add-form" style="display:none;" method="post" action="" novalidate>
          {% csrf_token %}
          <div class="inputs-cont">
            <label for="user-points">Sumar puntos:</label>
            <input
              placeholder="Ingresar puntos"
              type="number"
              min="0"
              inputmode="numeric"
              name="user-points"
              id="user-points"
              required
            />
            <label for="add-description">Descripción:</label>
            <textarea
              placeholder="Ingrese una descripción o motivo"
              name="description"
              id="add-description"
            ></textarea>
          </div>
          <button type="submit" class="red-btn save-btn">Guardar</button>
          <label class="checkbox-label">
            <input type="checkbox" id="add-checkbox" name="checkbox-option" checked />
            ¿Notificar?
          </label>
        </form>

        <form id="minus-form" style="display:none;" method="post" action="" novalidate>
          {% csrf_token %}
          <div class="inputs-cont">
            <label for="user-minus-points">Gastar puntos:</label>
            <input
              placeholder="Ingresar puntos"
              type="number"
              min="0"
              inputmode="numeric"
              name="user-minus-points"
              id="user-minus-points"
              required
            />
            <label for="minus-description">Descripción:</label>
            <textarea
              placeholder="Ingrese una descripción o motivo"
              name="description"
              id="minus-description"
            ></textarea>
          </div>
          <button type="submit" class="red-btn save-btn">Guardar</button>
          <label class="checkbox-label">
            <input type="checkbox" id="minus-checkbox" name="checkbox-option" checked />
            ¿Notificar?
          </label>
        </form>

      </div><!-- /manager-forms -->
    </div><!-- /manager-mod-container -->

  </div><!-- /admin-manager-container -->


  <script>
    const addBtn      = document.getElementById('add-btn')
    const minusBtn    = document.getElementById('minus-btn')
    const managerForms = document.getElementById('manager-forms')
    const addForm     = document.getElementById('add-form')
    const minusForm   = document.getElementById('minus-form')

    function showForm(formToShow, formToHide, activeBtn, inactiveBtn) {
      formToHide.style.display = 'none'
      managerForms.style.display = 'block'
      formToShow.style.display  = 'flex'

      activeBtn.classList.add('disabled-btn')
      activeBtn.setAttribute('aria-expanded', 'true')

      inactiveBtn.classList.remove('disabled-btn')
      inactiveBtn.setAttribute('aria-expanded', 'false')

      // Scroll suave al formulario en móvil
      managerForms.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    addBtn.addEventListener('click', function () {
      if (addForm.style.display === 'none') {
        showForm(addForm, minusForm, addBtn, minusBtn)
      }
    })

    minusBtn.addEventListener('click', function () {
      if (minusForm.style.display === 'none') {
        showForm(minusForm, addForm, minusBtn, addBtn)
      }
    })
  </script>
{% endblock %}
